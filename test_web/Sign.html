<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agreement Contract Web App</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
</head>
<body>
    <button id="connectButton">Connect to MetaMask</button>
    <p id="accountArea"></p>

    <button id="connectContractButton">Connect to Contract</button>
    <p id="contractArea"></p>
    
    <h2>Team Manager Information</h2>
    <form id="teamManagerForm">
        <label for="agency">Agency Address:</label>
        <input type="text" id="agency" name="agency" required>
        <label for="offerName">Offer Name:</label>
        <input type="text" id="offerName" name="offerName" required>
        <label for="offerPrice">Offer Price:</label>
        <input type="number" id="offerPrice" name="offerPrice" required>
        <button type="button" id="signContractButton">Sign Contract</button>
        <button type="button" id="getContractDetailsButton">Get Contract Details</button>
    </form>

    <p id="resultArea"></p>

    <script>
        window.addEventListener('load', function () {
            const connectButton = document.getElementById("connectButton");
            const connectContractButton = document.getElementById("connectContractButton");
            const signContractButton = document.getElementById("signContractButton");
            const accountArea = document.getElementById("accountArea");
            const contractArea = document.getElementById("contractArea");
            const resultArea = document.getElementById("resultArea");
            const getContractDetailsButton = document.getElementById("getContractDetailsButton");

            let account;
            let contract;

            const contractAddress = "0x5428d444F3BADf2b9C20648282EBBA38d4556AbA"; // Replace with your contract address
            const contractABI = [
    {
      "inputs": [],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "teamManager",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "address",
          "name": "agency",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "address",
          "name": "aman",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "string",
          "name": "offerName",
          "type": "string"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "offerPrice",
          "type": "uint256"
        }
      ],
      "name": "ContractSigned",
      "type": "event"
    },
    {
      "inputs": [],
      "name": "agency",
      "outputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "aman",
      "outputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "contractDetails",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "offerPrice",
          "type": "uint256"
        },
        {
          "internalType": "string",
          "name": "offerName",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getContractDetails",
      "outputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        },
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        },
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "_agency",
          "type": "address"
        },
        {
          "internalType": "string",
          "name": "_offerName",
          "type": "string"
        },
        {
          "internalType": "uint256",
          "name": "_offerPrice",
          "type": "uint256"
        }
      ],
      "name": "signContract",
      "outputs": [],
      "stateMutability": "payable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "teamManager",
      "outputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    }
  ];

            const connectMetamask = async () => {
                try {
                    if (window.ethereum) {
                        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                        account = accounts[0];
                        console.log(account);
                        accountArea.textContent = account;
                    } else {
                        accountArea.textContent = "Please install Metamask or use a web3 browser";
                    }
                } catch (error) {
                    console.error(error);
                    accountArea.textContent = "An error occurred while connecting Metamask";
                }
            }

            const connectContract = async () => {
                try {
                    if (account) {
                        window.web3 = new Web3(window.ethereum);
                        contract = new window.web3.eth.Contract(contractABI, contractAddress);
                        contractArea.textContent = "Connected to contract at address: " + contractAddress;
                    } else {
                        contractArea.textContent = "Please connect to MetaMask first";
                    }
                } catch (error) {
                    console.error(error);
                    contractArea.textContent = "An error occurred while connecting to the contract";
                }
            }

            const signContract = async () => {
    try {
        if (account && contract) {
            const agency = document.getElementById("agency").value;
            const offerName = document.getElementById("offerName").value;
            const offerPrice = document.getElementById("offerPrice").value;

            // Convert offerPrice to wei
            const offerPriceWei = window.web3.utils.toWei(offerPrice.toString(), 'ether');

            await contract.methods.signContract(agency, offerName, offerPriceWei).send({ from: account, value: offerPriceWei });
            resultArea.textContent = "Contract signed successfully";
        } else {
            resultArea.textContent = "Please connect to MetaMask and the contract first";
        }
    } catch (error) {
        console.error(error);
        resultArea.textContent = "An error occurred while signing the contract";
    }
}

            const getContractDetails = async () => {
                try {
                    if (account && contract) {
                        const result = await contract.methods.getContractDetails().call({ from: account });
                        console.log(result);

                        // Update your UI or perform other actions with the retrieved data
                        // Example: Display the contract details in the resultArea
                        resultArea.textContent = `
                            Team Manager: ${result[0]}
                            Agency: ${result[1]}
                            Aman Account: ${result[2]}
                            Offer Price ${result[3]}
                            Offer Name: ${result[4]}
                            Contract Signed: ${result[5]}
                        `;
                    } else {
                        console.log("Please connect to MetaMask and the contract first");
                    }
                } catch (error) {
                    console.error(error);
                    console.log("An error occurred while getting contract details");
                }
            };

            connectButton.addEventListener('click', connectMetamask);
            connectContractButton.addEventListener('click', connectContract);
            signContractButton.addEventListener('click', signContract);
            getContractDetailsButton.addEventListener('click', getContractDetails);
        });
    </script>
</body>
</html>
