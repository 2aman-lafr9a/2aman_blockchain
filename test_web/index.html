<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Contract Web App</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
</head>
<body>
    <button id="connectButton">Connect Metamask</button>
    <p id="accountArea"></p>
    <button id="connectContractButton">Connect Contract</button>
    <p id="contractArea"></p>
    <button id="getCityButton">Get My City</button>
    <p id="myCityArea"></p>
    <button id="changeCityButton">Change City</button>
    <input type="text" id="cityInput" placeholder="Enter your city">
    
    
    <script>
        
        window.addEventListener('load', function () {
            // Get the elements from the DOM
            const connectButton = document.getElementById("connectButton");
            const getCityButton = document.getElementById("getCityButton");
            const connectContractButton = document.getElementById("connectContractButton");
            const changeCityButton = document.getElementById("changeCityButton"); 
            const accountArea = document.getElementById("accountArea");
            const myCityArea = document.getElementById("myCityArea");
            const contractArea = document.getElementById("contractArea");

            // Define the contract address and ABI
            const contractAddress = "0x080505AB0326B82cfe24b017D9f2B0F0Ee75A522"; // Replace with your contract address
            const contractABI = [
                {
                    "constant": true,
                    "inputs": [
                        {
                            "internalType": "string",
                            "name": "_newCity",
                           "type": "string"
                        }
                    ],
                    "name": "SetMyCity",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "getMyCity",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                
                }
                
            ]; // Replace with your contract ABI

            // Define a variable to store the account address
            let account;

            // Define a function to connect Metamask
            const connectMetamask = async () => {
                try {
                    // Check if the browser supports Ethereum
                    if (window.ethereum !== "undefined") {
                        // Request the user to connect their account
                        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                        // Store the account address
                        account = accounts[0];
                        // Display the account address
                        accountArea.textContent = account;
                    } else {
                        // Warn the user that they need a web3 browser or extension
                        accountArea.textContent = "Please install Metamask or use a web3 browser";
                    }
                } catch (error) {
                    // Handle any errors
                    console.error(error);
                    accountArea.textContent = "An error occurred while connecting Metamask";
                }
            }

            // Define a function to connect the contract
            const connectContract = async () => {
                try {
                    // Check if the account is connected
                    if (account) {
                        window.web3 = await new Web3(window.ethereum);
                        // Create a contract instance using the provider
                        window.contract= new window.web3.eth.Contract(contractABI, contractAddress);
                        // Display the contract address
                        contractArea.textContent = "Connected to contract with address: " + window.contract.options.address;
                    } else {
                        // Warn the user that they need to connect their account
                        contractArea.textContent = "Please connect your Metamask account first";
                    }
                } catch (error) {
                    // Handle any errors
                    console.error(error);
                    contractArea.textContent = "An error occurred while connecting the contract";
                }
            }
            // Define a function to get the city from the contract
            const getMyCity = async () => {
                try {
                    // Check if the account is connected
                    if (account) {
                      const data = await window.contract.methods.getMyCity().call();
                        // Display the city
                        myCityArea.textContent = data;
                       
                    } else {
                        // Warn the user that they need to connect their account
                        myCityArea.textContent = "Please connect your Metamask account first";
                    }
                } catch (error) {
                    // Handle any errors
                    console.error(error);
                    myCityArea.textContent = "An error occurred while getting the city";
                }
            }
            const SetMyCity = async () => {
                try {
                    // Check if the account is connected
                    if (account) {
                        const city = document.getElementById("cityInput").value;
                        await window.contract.methods.SetMyCity(city).send({from: account});
                    } else {
                        // Warn the user that they need to connect their account
                        myCityArea.textContent = "Please connect your Metamask account first";
                    }
                } catch (error) {
                    // Handle any errors
                    console.error(error);
                    myCityArea.textContent = "An error occurred while getting the city";
                }
            }
            
            // Add event listeners to the buttons
            connectButton.addEventListener('click', connectMetamask);
            getCityButton.addEventListener('click', getMyCity);
            connectContractButton.addEventListener('click', connectContract);
            changeCityButton.addEventListener('click', SetMyCity);
        })
    </script>
</body>
</html>
